### 통계정보

- 테이블 및 인덱스 통계 정보

  : 비용 기반 최적화를 진행하면서 휘바뢰는 통계정보 + 실제 테이블의 일부를 분석

  ++ v.5.6 ~ : InnoDB 엔진의 통계 정보를 영구적으로 저장 (필요시 업데이트 됨)

- 히스토그램 (~ v.8.0)

  : 칼럼의 데이터 분포도

  수동으로 수집 및 관리

    - 수집된 히스토그램 정보는 딕셔너리에 함께 저장. MySQL서버가 시작될 때 딕셔너리의 히스토그램 정보를 로드
        - 높이 균형 히스토그램 : 칼럼값의 범위를 균등한 개수로 구분해서 관리
        - 싱글톤 히스토그램 : 칼럼값 개별로 레코드 건수를 관리하는 히스토그램
    - 사용 이유

  `where [user.id](http://user.id) = matt.lee` 이런 동등 비교 상황에서 데이터 예측을 하기 위해서는 균등한 분포를 가지는게 정확성이 높음

  히스토 그램은 각 범위(버킷
  )별 레코드의 건수와 유니크한 값의 개수 정보를 가지기 때문에 훨씬 정확하게 예측 가능

- 실행 계획시 사용 상황

실행 계획 수립 :

사용 가능한 인덱스들로부터 조건절에 일치하는 레코드 건수를 댸략 파악 → 최종적으로 나은 실행 계획을 선택

조건절의 경우, 레코드 건수를 예측하기 위해 실제 인덱스의 B- Tree를 샘플링 (인덱스 다이브)

히스토그램 - 인덱스되지 않은 칼럼에 대한 데이터 분포도를 참조하는 용도로 사용

### 코스트 모델

: 비용 산정시 필요한 단위 작업들의 비용

- 작업
    - 디스크로부터 데이터 페이지 읽기
    - 메모리(InnoDB 버퍼 풀)로 부터 데이터 페잊 ㅣ읽기
    - 인덱스 키 비교
    - 레코드 평가
    - 메모리 임시 테이블 작업
    - 디스크 임시 테이블 작업

각 단위 작업에 설정되는 비용 값이 커지면 어떤 실행 계획들이 고비용으로 바뀌고 저비용으로 바뀌는지 파악하는 것이 중요

### 실행 계획

- 실행 계획 확인 : DESC ,EXPLAIN 명령어로 확인 가능
- 쿼리 실행 시간 확인 : EXPLAIN ANAYIZE, SHOW PROFILE

- 쿼리 분석 : 위의 명령어로 실행을 하게 되면 단위 쿼리로 잘라 분석을 해줌

내부에 있는 쿼리 문인지 외부에 있는 쿼리문인지를 종류별로 구별하여 내려줌